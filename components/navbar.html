<link rel="stylesheet" type="text/css" href="../assets/vendors/bootstrap/css/bootstrap.min.css">
<script type="text/javascript" src="../assets/vendors/bootstrap/js/bootstrap.min.js"></script>
<nav class="navbar-main">
	<div class="navbar-item" id="navbar-logo">

	</div>
	<a href="../pages/home.html">
		<div class="navbar-item" id="homeLink">Home</div>
	</a>
	<a href="../pages/employee.html">
		<div class="navbar-item" id="employeeLink">Employee</div>
	</a>
	<a href="../pages/item.html">
		<div class="navbar-item" id="itemLink">Items</div>
	</a>
	<a href="../pages/assignment.html">
		<div class="navbar-item" id="assignmentLink">Assignments</div>
	</a>
	<div class="navbar-item" id="navbar-profile" data-toggle="modal" data-target="#modalProfile"></div>
</nav>

<div class="modal fade" tabindex="-1" role="dialog" id="modalProfile">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Profile</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-12 d-flex justify-content-center">
						<img id="employeeImage" src="../assets/images/icons/placeholder.png" class="rounded-circle" width="40%" height="100%">
					</div>
				</div>
				<div class="row">
					<div class="col-12 d-flex justify-content-center" id="employeeName">

					</div>
				</div>
				<div class="row">
					<div class="col-12 d-flex justify-content-center" id="employeeId">

					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnLogout">Logout</button>
			</div>
		</div>
	</div>
</div>

<script>
	$(document).ready(function(){
		$.ajax({
			type: "GET",
			async: false,
			url: "http://localhost:8080/user",
			beforeSend: function (request) {
				request.setRequestHeader("Authorization-key", getCookie("token"));
			},
			success: function (response) {
				var role = getCookie("token");
				if(role.includes("ADMIN")){
					$("#navbar-profile").html("Welcome, Admin");
				}
				else{
					$("#navbar-profile").html("Welcome, "+response.name);
				}
			},
			error: function () {

			}
		})
	})

	$("#navbar-profile").on("click", function () {
		$.ajax({
			type: "GET",
			async: false,
			url: "http://localhost:8080/user",
			beforeSend: function (request) {
				request.setRequestHeader("Authorization-key", getCookie("token"));
			},
			success: function (response) {
				if (response.imagePath) {
					var image = response.imagePath;
					image = image.split("/");
					image = image.pop();
					$("#employeeImage").attr("src", "../assets/images/employees/" + image);
				}
				$("#employeeName").html(response.name);
				$("#employeeId").html(response.id);
			},
			error: function () {

			}
		})
	})

	$("#btnLogout").click(function () {
		$.ajax({
			type: "POST",
			async: false,
			url: "http://localhost:8080/logout",
			beforeSend: function (request) {
				request.setRequestHeader("Authorization-key", getCookie("token"));
			},
			success: function (response) {
				if (response.code === "OK") {
					document.cookie = 'token=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';

					alert("Logged Out");
					window.location.replace("../../pages/login.html");
				}
			},
			error: function (response) {
				console.log(response);
				alert("Cuurently can't logout");
			}
		})
		return false;
	})
</script>